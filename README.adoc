= A Git difftool for BPMN-files

image::https://api.travis-ci.org/38leinaD/bpmn-diff.svg[]

This tool is a repackaging of https://github.com/bpmn-io/bpmn-js-diffing (see here for the link:https://demo.bpmn.io/diff[online version])
allowing it to be invoked from the commandline.
Due to this, it can be used as a link:https://git-scm.com/docs/git-difftool[difftool] for Git.

image::https://s3.gifyu.com/images/bpmn-diff748dbead2328ed91.gif[]

== Usage

For now, build the project locally:

----
git clone https://github.com/38leinaD/bpmn-diff.git
cd bpmn-diff
./gradlew build
----


You should now find the `bpmn-diff.jar` under `bpmn-diff/build/libs` and example BPMN files under `bpmn-diff-webapp/resources`. We can compare them with:

----
java -jar bpmn-diff/build/libs/bpmn-diff.jar ./bpmn-diff-webapp/resources/pizza-collaboration/old.bpmn ./bpmn-diff-webapp/resources/pizza-collaboration/new.bpmn
----

A browser windows should open up showing the webapp. On close of the browser, the application should terminate.

You can't just diff individual files but also perform a diff on a whole folders.

=== Usage as Git difftool

Add the following to your `.gitconfig`

----
[difftool "bpmn"]
    cmd = java -jar <full-path-to-repo>/bpmn-diff/build/libs/bpmn-diff.jar $LOCAL $REMOTE
    trustExitCode = false
----

==== Commands

Assuming you have a Git repository with some BPMB-files, here are some useful commands:

Diff on `flow.bpmn` between latest and previous commit:

----
git difftool -t bpmn HEAD~1 HEAD flow.bpmn
----

If you run above command without the filename, it will do a diff for the whole commit. This means, the difftool will be invoked for each file one after the other.
This is not very useful as you will have to inspect each BPMN file one after the other and the difftool will also be invoked for changes in files that are not BPMN-files.
For this reason, there is `--dir-diff` which is also supported by this tool: 

----
git difftool --dir-diff -t bpmn HEAD~1 HEAD
----

This will open a pane to switch between files.

== Browser Detection

The tool opens the difftool in a browser installed on your system. By default the `BestFit` strategy is used which will try to detect an appropriate browser in the following way:

. If the environment variable `BROWSER_COMMAND` is defined, run this with the URL of the webapp as parameter.
. If the executable `google-chrome` is detected on your `PATH`, use this executable.
. If the executable `firefox` is detected on your `PATH`, use this executable.
. Else, ask the operating system to use the default browser.

Other strategies can be selected via the command-line flag `-browser=`. Values are `BestFit`, `Chrome`, `Firefox`, `System`.
`System` will try to use whatever browser is configured by the operating system.

TODO: Testing has been done with Linux only. So, setting  `Chrome` or`Firefox` might fail on windows as it only checks if specifically named executables are found on the `PATH`.
